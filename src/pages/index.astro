---
import MainLayout from '../layouts/MainLayout.astro'
import DisplayPosts from '../components/DisplayPosts.astro';
import { getCollection } from 'astro:content';
const posts = await getCollection('posts');
const tags = posts.reduce<Record<string, typeof posts>>((allTags, post) => {
    const postTags = post.data.tags;
    if (postTags) {
        postTags.forEach((tag) => {
            if (!allTags[tag]){
                allTags[tag] = [];
            }
            allTags[tag].push(post);
        });
    }
    return allTags;
}, {});
let sortedPosts = posts ? posts.sort(
    (a, b) => new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf()
) : [];
---
<MainLayout title='Max Lewis Blog'> 
    <DisplayPosts posts={sortedPosts} tags={Object.keys(tags)} />
</MainLayout>
